function addNewRow(element,item=null){let el=$(element),expenseTypeUrl=el.data("type-url"),tbody=el.find("tbody"),i=tbody.find("tr").length,row=`<tr id="row-${i}">`;return row+=`<td>\n                <select name="collection[${i}][type_id]" id="type-id-${i}" class="form-control" data-ajax-url="${expenseTypeUrl}" data-placeholder="${localize("Choose Expense Type")}" required >`,item&&item.type&&(row+=`<option value="${item.type.id}" selected >${item.type.name}</option>`),row+=`</select><label class="error" for="type-id-${i}"></label></td>`,row+=`<td>\n                <input type="number" class="form-control arrow-hidden" onclick="selectAll(this)" onchange="calculateTotal()" oninput="calculateTotal()"  id="quantity-${i}"\n                name="collection[${i}][qty]"\n                value="${item?item.qty:"0"}" min="0"\n                required>\n            </td>`,row+=`<td>\n                <input type="number" class="form-control arrow-hidden" onclick="selectAll(this)" onchange="calculateTotal()" oninput="calculateTotal()"  id="unit_price-${i}"\n                name="collection[${i}][price]"\n                value="${item?item.price:"0.00"}" step=".01" min="0.01"\n                required>\n            </td>`,row+=`<td class="">\n                    <input type="number" class="form-control text-end" id="sub-total-${i}" value="0.00" step=".01" disabled>\n                </td>`,row+="<td>",row+=0==i?`<button type="button" class="btn btn-success my-1" onclick="addNewRow('${element}')">\n                <i class="fa fa-plus-circle"></i>\n            </button>`:` <button type="button" class="btn btn-danger my-1" onclick="deleteRow(${i})">\n                <i class="fa fa-trash"></i>\n            </button>`,row+="</td>",row+="</tr>",tbody.append(row),expenseTypeSelect2AjaxInit(i),i}function deleteRow(i){let row=$(`#row-${i}`);row.find("tbody").find("tr").length<1?(row.remove(),calculateTotal()):alert("You can't delete the last row")}function selectAll(el){el.select()}function calculateTotal(element="#purchase-table"){let rows=$(element).find("tbody tr"),gt=0;rows.each((function(i,row){let q=0,u=0,st=0;q=(row=$(row)).find(`#quantity-${i}`).val()??0,u=row.find(`#unit_price-${i}`).val()??0,st=parseFloat(q)*parseFloat(u),gt+=st,row.find(`#sub-total-${i}`).val(st.toFixed(2))})),$(".gross_total").val(gt.toFixed(2))}function expenseTypeSelect2AjaxInit(i){element=`#type-id-${i}`;let options=$(element).find("option").map((function(){return{id:$(this).val(),text:$(this).text()}})).get();$(element).select2({width:"100%",ajax:{placeholder:$(element).data("placeholder")??"",url:$(element).data("ajax-url")??"",dataType:"json",delay:250,data:function(params){return{search:params.term,page:params.page||1}},processResults:function(data,params){return params.page=params.page||1,results=data.data,params.term?(filterOptions=options.filter((function(item){return item.text.toLowerCase().includes(params.term.toLowerCase())})),results=filterOptions.concat(results)):results=options.concat(results),{results:results,pagination:{more:data.current_page<data.last_page}}},cache:!0},placeholder:localize("Search...")??"Search...",language:{searching:function(){return localize("Loading...")??"Loading..."}}})}$((function(){$details=JSON.parse($("#purchase-table tbody").attr("data-details")),$details.length>0?$details.forEach(((item,i)=>{console.log(item);addNewRow("#purchase-table",item)})):addNewRow("#purchase-table"),calculateTotal(),select2AjaxInit("#employee_id"),select2AjaxInit("#vendor_id"),select2AjaxInit("#vehicle_id"),select2AjaxInit("#trip_type_id"),select2AjaxInit("#maintenance_type_id")}));